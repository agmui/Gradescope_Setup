rules:
- id: test
  mode: join
  join:
    rules:
      - id: t1
        pattern: |
          void *thread(void *arg) {
            ...
            pthread_mutex_lock(&$MUTEX);
            while($THREAD_NUM1){
              pthread_cond_wait(&$COND_VAR,&$MUTEX);
            }
            $THREAD_NUM2;
            pthread_mutex_unlock(&$MUTEX);
            ...
            sleep(1);
            pthread_mutex_lock(&$MUTEX);
            $THREAD_NUM3;
            pthread_mutex_unlock(&mutex);
            ...
            pthread_cond_signal(&c);
          }
        languages: [c]

      - id: t2
        languages: [c]
        patterns:
          - pattern-inside: |
              void *thread(void *arg){
                ...
              }
          - pattern-either:
            - pattern: |
                $THREAD_NUM3--;
            - pattern: |
                $THREAD_NUM3-=1;
            
    on:
    - 't1.$THREAD_NUM3 == t2.$THREAD_NUM3'
  message: hi
  severity: ERROR